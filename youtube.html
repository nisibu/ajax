<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <title>æ°—åˆ†ã§é¸ã¶éŸ³æ¥½ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="https://www.youtube.com/iframe_api"></script>
</head>

<body>
    <div>
        <h1>æ°—åˆ†ã«åˆã‚ã›ã¦éŸ³æ¥½ã‚’å†ç”Ÿã—ã‚ˆã†</h1>

        <button class="mood-button happy" onclick="selectMood('happy')">å…ƒæ°—</button>
        <button class="mood-button sad" onclick="selectMood('sad')">åˆ‡ãªã„</button>
        <button class="mood-button relax" onclick="selectMood('relax')">ãƒªãƒ©ãƒƒã‚¯ã‚¹</button>
        <button class="mood-button focus" onclick="selectMood('focus')">é›†ä¸­ã—ãŸã„</button>

        <br />
        <button id="next-button">æ¬¡ã®å‹•ç”» â–¶</button>

        <div id="player"></div>
    </div>

    <script>
        const moodToKeyword = {
            happy: "æ˜ã‚‹ã„ äººæ°—æ›² ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ æ¥½ã—ã„ å…ƒæ°— ",
            sad: "åˆ‡ãªã„ ãƒãƒ©ãƒ¼ãƒ‰ JPOP å¤±æ‹ æ³£ã‘ã‚‹ æ›² äººæ°—",
            relax: "ãƒªãƒ©ãƒƒã‚¯ã‚¹ ç™’ã— BGM ã‚«ãƒ•ã‚§ ã‚¢ãƒ³ãƒ“ã‚¨ãƒ³ãƒˆ",
            focus: "é›†ä¸­ ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ lofi chill ä½œæ¥­ç”¨ BGM"
        };

        let currentMood = "";
        let currentItems = [];
        let usedIndexes = [];
        let playerAPI;

        function onYouTubeIframeAPIReady() {
            playerAPI = new YT.Player('player', {
                events: {
                    'onReady': event => event.target.stopVideo()
                }
            });
        }

        function selectMood(mood) {
            currentMood = mood;
            usedIndexes = [];
            const query = moodToKeyword[mood];
            fetchYoutubeVideos(query);
            applyMoodTheme(mood);

            if (mood === "happy") {
                startHeartAnimation();
                stopRain();
            } else if (mood === "sad") {
                stopHeartAnimation();
                startRain();
            } else {
                stopHeartAnimation();
                stopRain();
            }
        }

        function fetchYoutubeVideos(query) {
            const apiKey = "AIzaSyD03HtcqnR0L3GOxmeC_sQwBOnLPHpAfSk"; // â† APIã‚­ãƒ¼ã‚’å®Ÿéš›ã®ã‚‚ã®ã«
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=10&key=${apiKey}`;

            fetch(url)
                .then(res => res.json())
                .then(data => {
                    if (data.items.length > 0) {
                        currentItems = data.items;
                        showRandomVideo();
                        document.getElementById("next-button").style.display = "inline-block";
                    } else {
                        alert("å‹•ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
                    }
                })
                .catch(err => {
                    console.error("ã‚¨ãƒ©ãƒ¼:", err);
                    alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
                });
        }

        function showRandomVideo() {
            if (usedIndexes.length === currentItems.length) usedIndexes = [];
            let index;
            do {
                index = Math.floor(Math.random() * currentItems.length);
            } while (usedIndexes.includes(index));
            usedIndexes.push(index);

            const videoId = currentItems[index].id.videoId;
            const iframe = document.createElement('iframe');
            iframe.width = "560";
            iframe.height = "315";
            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1`;
            iframe.frameBorder = "0";
            iframe.allow = "autoplay; encrypted-media";
            iframe.allowFullscreen = true;

            const player = document.getElementById("player");
            player.innerHTML = '';
            player.appendChild(iframe);
        }

        document.getElementById("next-button").addEventListener("click", showRandomVideo);

        // ğŸˆ ãƒãƒ¼ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

        let heartInterval;

        function startHeartAnimation() {
            if (heartInterval) return;
            heartInterval = setInterval(() => {
                const heart = document.createElement("div");
                heart.className = "heart";
                heart.style.left = Math.random() * 100 + "vw";  // ãƒ©ãƒ³ãƒ€ãƒ ã«æ¨ªä½ç½®ã‚’æ±ºã‚ã‚‹
                heart.style.top = "100vh";  // ä¸‹ã‹ã‚‰å‡ºã¦ãã‚‹

                // ã‚«ãƒ©ãƒ•ãƒ«ãªãƒãƒ¼ãƒˆã®è‰²ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«è¨­å®š
                const colors = ["#FF5733", "#33FF57", "#5733FF", "#FF33A6", "#33FFF5", "#F1C40F"];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                heart.style.backgroundColor = randomColor;

                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 4000);  // 4ç§’å¾Œã«ãƒãƒ¼ãƒˆã‚’å‰Šé™¤
            }, 300);  // 300msã”ã¨ã«æ–°ã—ã„ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º
        }

        function stopHeartAnimation() {
            clearInterval(heartInterval);
            heartInterval = null;
            document.querySelectorAll(".heart").forEach(el => el.remove());  // å…¨ã¦ã®ãƒãƒ¼ãƒˆã‚’å‰Šé™¤
        }

        // ğŸŒ§ï¸ é›¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        let rainInterval;
        function startRain() {
            if (rainInterval) return;
            rainInterval = setInterval(() => {
                const drop = document.createElement("div");
                drop.className = "raindrop";
                drop.style.left = Math.random() * window.innerWidth + "px";
                drop.style.animationDuration = (1 + Math.random()).toFixed(2) + "s";
                document.body.appendChild(drop);
                setTimeout(() => drop.remove(), 2000);
            }, 100);
        }

        function stopRain() {
            clearInterval(rainInterval);
            rainInterval = null;
            document.querySelectorAll(".raindrop").forEach(el => el.remove());
        }

        // ğŸŒˆ èƒŒæ™¯ãƒ†ãƒ¼ãƒï¼ˆä»»æ„ã§æ‹¡å¼µå¯ï¼‰
        function applyMoodTheme(mood) {
            const body = document.body;
            body.style.animation = "none";
            switch (mood) {
                case "happy":
                    body.style.backgroundImage = "linear-gradient(270deg, #fff176, #ff8a65)";
                    break;
                case "sad":
                    body.style.backgroundImage = "linear-gradient(270deg, #90caf9, #3f51b5)";
                    break;
                case "relax":
                    body.style.backgroundImage = "linear-gradient(270deg, #b2dfdb, #81d4fa)";
                    break;
                case "focus":
                    body.style.backgroundImage = "linear-gradient(270deg, #cfd8dc, #37474f)";
                    break;
            }
        }
        let bubbleInterval;

        function startBubbleAnimation() {
            if (bubbleInterval) return;
            bubbleInterval = setInterval(() => {
                const bubble = document.createElement("div");
                bubble.className = "bubble";
                const size = Math.random() * 20 + 10; // 10ã€œ30px
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = Math.random() * window.innerWidth + "px";
                bubble.style.animationDuration = (4 + Math.random() * 2).toFixed(2) + "s";
                document.body.appendChild(bubble);
                setTimeout(() => bubble.remove(), 6000);
            }, 300);
        }

        function stopBubbleAnimation() {
            clearInterval(bubbleInterval);
            bubbleInterval = null;
            document.querySelectorAll(".bubble").forEach(el => el.remove());
        }

        function selectMood(mood) {
            currentMood = mood;
            usedIndexes = [];
            const query = moodToKeyword[mood];
            fetchYoutubeVideos(query);
            applyMoodTheme(mood);

            if (mood === "happy") {
                startHeartAnimation();
                stopRain();
                stopBubbleAnimation();
            } else if (mood === "sad") {
                stopHeartAnimation();
                startRain();
                stopBubbleAnimation();
            } else if (mood === "relax") {
                stopHeartAnimation();
                stopRain();
                startBubbleAnimation();
            } else {
                stopHeartAnimation();
                stopRain();
                stopBubbleAnimation();
            }
        }

    </script>
</body>

</html>